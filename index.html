<!DOCTYPE html>

<head>
    <meta charset="utf-8" />
    <title>Mail Finder</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- THIS IS THE POPUP BOX THAT WILL POP UP WITH A CERTAIN TEXT CONTENT CALLED VIA JAVASCRIPT -->
    <div id="PopUpBox"></div>

    <section id="Top">
        <div class="Left">
            <h1 id="LightModus" onclick="changeLightModus('dark')">Converting your list of contacts into emails</h1>
            <h4>
                Please enter the full name and email domain of one of your contacts into the designated input fields.
                Upon clicking the ‘Convert’ button, a list of potential email addresses will be generated and automatically
                copied to your clipboard. To organize your entire contact list, choose the appropriate email address and paste your contacts into the text area on the right.
            </h4>

            <!-- INPUT SECTION: -->
            <span>Fullname: <input type="text" placeholder="Firstname prefixes Surname" id="InputFullName" /></span>
            <span>Domain: <input type="text" placeholder="@domain.com" id="InputDomain" /></span>
            <button id="btn_convert" onclick="getMailFormatOptions()">Convert</button>
        </div>
        <div class="Right">

            <!-- LARGE INPUT SECTION -->
            <textarea id="allNames" ondblclick="refreshTextArea()">Fullname prefixes Surname, Fullname prefixes Surname, Fullname prefixes Surname</textarea>
        </div>
    </section>
    <section id="Bot">

        <!-- MAIL DISPLAYS THAT WILL UPDATE WHEN INPUTS ARE GIVEN -->
        <div class="Left" id="MailFormatsBox">
            <ul id="MailFormatsContent"></ul>
        </div>
        <div class="Right" id="CorrMailsBox">
            <ul id="CorrMailsContent"></ul>
        </div>
    </section>
</body>

<script>
    const TextBoxContent = document.getElementById('MailFormatsContent');
    const AnswBoxContent = document.getElementById('CorrMailsContent');
    let MailDomain = document.getElementById("InputDomain").value;
    let counter = true;
    let firstContact = '';


    //CHECK IF BROWSER COLOR SCHEME IS SET TO DARK: IF SO SET WEBPAGE COLOR SCHEME ALSO TO BLACK
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        changeLightModus('dark');
    }

    //LIGHT MODUS CHANGE FUNCTION: WITH 'MODUS' = 'dark' OR 'light' AS INPUT;
    function changeLightModus(modus) {
        switch (modus) {
            case 'dark':
                //CHANGE INPUT STATUS TO LIGHT MODUS ON BUTTON
                document.getElementById('LightModus').setAttribute("onclick", "changeLightModus('light')");
                //CHANGE CSS GLOBAL VARIABLES TO DARK THEME
                document.documentElement.style.setProperty("--col-background", 'black');
                document.documentElement.style.setProperty("--col-popup", '#FFFFFF');
                document.documentElement.style.setProperty("--col-popup-txt", 'black');
                document.documentElement.style.setProperty("--col-txt", '#FFFFFF');
                document.documentElement.style.setProperty("--col-border", '#FFFFFF');

                break;
            case 'light':
                //CHANGE INPUT STATUS TO LIGHT MODUS ON BUTTON
                document.getElementById('LightModus').setAttribute("onclick", "changeLightModus('dark')");
                //CHANGE CSS GLOBAL VARIABLES TO DARK THEME
                document.documentElement.style.setProperty("--col-background", '#FFFFFF');
                document.documentElement.style.setProperty("--col-popup", 'black');
                document.documentElement.style.setProperty("--col-popup-txt", '#FFFFFF');
                document.documentElement.style.setProperty("--col-txt", 'black');
                document.documentElement.style.setProperty("--col-border", 'black');

                break;
            default:
                //IF AN ERROR OCCURS IT SHOULD DEFAULT ITSELF TO LIGHT MODUS
                changeLightModus('light');
        }
    }

    //ARRAY + VAL --> INDEXES FUNCTION. A FUNCTION THAT RETURNS A LIST OF ALL INDEXES OF VALUE OCCURENCES WITHIN AN ARRAY
    function getAllIndexes(arr, val) {
        let indexes = [], i = -1;
        while ((i = arr.indexOf(val, i + 1)) != -1) {
            indexes.push(i);
        }
        return indexes;
    }

    //CLEAR TEXTAREA OF INNERTEXT WHEN DIV IS DOUBLE CLICKED
    function refreshTextArea() {
        document.getElementById('allNames').innerText = '';
    }

    //FUNCTION THAT READS THE TEXT AREA
    function readTextArea() {
        const TextArea = document.getElementById('allNames');
        const txt = TextArea.value;
        const txtTypes = {};

        //A: split TextArea value for each delimiter
        const delimiters = [';', ',', '\n', '_'];
        delimiters.forEach((delimiter, index) => {
            txtTypes[`Type${index + 1}`] = txt.split(delimiter);
        });

        //B: get index of most succesfull delimiter split
        const maxLength = Math.max(...Object.values(txtTypes).map(arr => arr.length));
        const indexMax = Object.values(txtTypes).findIndex(arr => arr.length === maxLength) + 1;

        //C: reformat the correctly split TextArea and remove any empty spaces (OTHER REFORMATIONS STILL NEED TO BE ADDED LIKE \n + " " COMBINATIONS)
        let AllNames = txtTypes[`Type${indexMax}`].map(name => name.trim().split(/\s+/g).join(' '));
        return AllNames;
    }

    //POP UP WINDOW FUNCTION
    function PopUpWindow(DisplayText) {
        PopUpBox = document.getElementById('PopUpBox');
        PopUpBox.innerText = DisplayText;

        if (counter) {
            PopUpBox.style.animation = 'PopUp1 4s';
            counter = false;
        }
        else {
            PopUpBox.style.animation = 'PopUp2 4s';
            counter = true;
        }
    }

    //COPY ALL CORRECTLY FORMATED EMAILS TO CLIPBOARD
    function CopyCorr() {
        const CorrMails = Array.from(document.getElementsByClassName('CorrMail'));
        let txt;

        //CHECK IF FIRST CONTACT INPUT IS FILLED IN: IF SO ALSO COPY THIS CONTACT TO CLIPBOARD
        if (InputFullName.value != '') {
            txt = [firstContact, ...CorrMails.map(mail => mail.innerText)].join('\n');
        } else {
            txt = [...CorrMails.map(mail => mail.innerText)].join('\n');
        }

        navigator.clipboard.writeText(txt);
        PopUpWindow('All correctly ***formatted contacts*** are copied to your clipboard');
    }

    //FUNCTION TO GET ALL HIGHLY LIKELY EMAIL FORMATS RETURNED INTO A LIB OF EMAIL FORMAT TYPES
    function ImprovedGetAllMailFormats(FullName, Type = -1) {
        let AllMailFormats = {};
        let NameSliced = FullName.map((item, index) => { return index === 0 ? item : item.toLowerCase(); });

        if (Type == 1 || Type == -1) {
            AllMailFormats['Type1'] = NameSliced.join('');
        }
        if (Type == 2 || Type == -1) {
            AllMailFormats['Type2'] = NameSliced.join('.');
        }
        if (Type == 3 || Type == -1) {
            AllMailFormats['Type3'] = NameSliced.join('-');
        }
        if (Type == 4 || Type == -1) {
            AllMailFormats['Type4'] = NameSliced.join('_');
        }
        if (Type == 5 || Type == -1) {
            AllMailFormats['Type5'] = NameSliced[0];
        }
        if (Type == 6 || Type == -1) {
            AllMailFormats['Type6'] = NameSliced[NameSliced.length - 1];
        }
        if (Type == 7 || Type == -1) {
            AllMailFormats['Type7'] = NameSliced.slice(1).join('');
        }
        if (Type == 8 || Type == -1) {
            AllMailFormats['Type8'] = NameSliced.map((i, index) => index === 0 ? i[0] : i).join('');
        }
        if (Type == 9 || Type == -1) {
            AllMailFormats['Type9'] = NameSliced.map(i => i[0]).join('');
        }
        if (Type == 10 || Type == -1) {
            AllMailFormats['Type10'] = NameSliced.map((i, index) => index === NameSliced.length - 1 ? i : i[0]).join('');
        }
        if (Type == 11 || Type == -1) {
            AllMailFormats['Type11'] = NameSliced.map((i, index) => index === 0 ? i + '.' : i).join('');
        }
        if (Type == 12 || Type == -1) {
            AllMailFormats['Type12'] = NameSliced.slice(1).map((i, index, arr) => index === arr.length - 1 ? i : i[0]).join('');
        }
        if (Type == 13 || Type == -1) {
            AllMailFormats['Type13'] = NameSliced.map((i, index) => index === 0 ? i[0] : i).join('.');
        }
        if (Type == 14 || Type == -1) {
            AllMailFormats['Type14'] = NameSliced.map((i, index) => index === 0 ? i[0] + '.' : i).join('');
        }
        if (Type == 15 || Type == -1) {
            AllMailFormats['Type15'] = NameSliced.map((i, index) => index === 0 ? i[0] + '-' : i).join('');
        }
        if (Type == 16 || Type == -1) {
            AllMailFormats['Type16'] = NameSliced.map((i, index) => index === 0 ? i[0] + '_' : i).join('');
        }
        if (Type == 17 || Type == -1) {
            AllMailFormats['Type17'] = NameSliced.map((i, index) => index === 0 ? i + '-' : i).join('');
        }
        if (Type == 18 || Type == -1) {
            AllMailFormats['Type18'] = NameSliced.map((i, index) => index === 0 ? i + '_' : i).join('');
        }

        return AllMailFormats;
    }

    //FUNCTION TO CREATE THE CORRECT EMAIL LIST IN HTML
    function createCorrMailListHTML() {
        const MailOptions = Array.from(document.getElementsByClassName('MailOption'));
        const AllNames = readTextArea();

        // Clear all ids and set the active one
        MailOptions.forEach((option, index) => {
            option.id = '';
            if (option.textContent === this.innerHTML) {
                Type = index + 1;
                this.id = 'active';
            }
        });

        // Format names and create list items
        const AllFormattedNames = AllNames.map(name => ImprovedGetAllMailFormats(name.split(' '), Type)[`Type${Type}`]);
        const AllCorrMails = AllFormattedNames.map(formattedName => formattedName + MailDomain);
        AnswBoxContent.innerHTML = '';

        AllCorrMails.forEach(CorrMail => {
            const li_CorrMail = document.createElement('li');
            li_CorrMail.innerText = CorrMail;
            li_CorrMail.addEventListener("click", CopyCorr);
            li_CorrMail.classList.add('CorrMail');
            AnswBoxContent.appendChild(li_CorrMail);
        });

        CopyCorr();
    }

    //FUNCTION TO CREATE THE EMAIL FORMAT OPTIONS LIST IN HTML
    function createMailFormatsListHTML(AllMailFormats) {
        TextBoxContent.innerHTML = '';

        AllMailFormats.forEach(MailOption => {
            const li_MailOption = document.createElement('li');
            li_MailOption.innerText = MailOption;
            li_MailOption.classList.add('MailOption');
            li_MailOption.addEventListener("click", createCorrMailListHTML);
            TextBoxContent.appendChild(li_MailOption);
        });
    }

    //FUNCTION TO GET ALL MAIL FORMAT OPTIONS: CALLED WHEN CONVERT BUTTON IS PRESSED
    function getMailFormatOptions() {
        MailDomain = document.getElementById("InputDomain").value;
        let SplittedFullName = document.getElementById("InputFullName").value.split(' ');

        if (SplittedFullName == '') {
            SplittedFullName = ['firstname', 'prefixes', 'surname'];
        }

        if (MailDomain == '') {
            MailDomain = "@mail.com";
        }

        if (SplittedFullName.length < 3) {
            PopUpWindow("Put in a Fullname with prefixes");
        } else {
            const MailFormatOptions = ImprovedGetAllMailFormats(SplittedFullName, -1);
            const AllMailFormats = Object.keys(MailFormatOptions).map(function (key) { return MailFormatOptions[key] + MailDomain; });
            createMailFormatsListHTML(AllMailFormats);
            navigator.clipboard.writeText(AllMailFormats.join('\n'));
            PopUpWindow("All possible ***mailing formats*** are copied to your clipboard");
        }
    }
</script>