<!DOCTYPE html>

<head>
    <meta charset="utf-8" />
    <title>Mail Finder</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div id="PopUpBox"></div>


    <section id="Top">
        <div class="Left">
            <h1>Converting your list of contacts into emails</h1>
            <h4>
                Please enter the full name and email domain of one of your contacts into the designated input fields.
                Upon clicking the ‘Convert’ button, a list of potential email addresses will be generated and automatically
                copied to your clipboard. To organize your entire contact list, choose the appropriate email address and either
                upload a CSV file or paste your contacts into the text area on the right.
            </h4>
            <span>Fullname: <input type="text" placeholder="Firstname prefixes Surname" id="InputFullName" /></span>
            <span>Domain: <input type="text" placeholder="@domain.com" id="InputDomain" /></span>
            <button id="btn_convert" onclick="getMailFormatOptions()">Convert</button>
        </div>
        <div class="Right">
            <input type="file"  id="CSVNames"/>
            <textarea id="allNames">Fullname prefixes Surname, Fullname prefixes Surname, Fullname prefixes Surname</textarea>
        </div>
    </section>
    <section id="Bot">
        <div class="Left" id="MailFormatsBox">
            <ul id="MailFormatsContent"></ul>
        </div>
        <div class="Right" id="CorrMailsBox">
            <ul id="CorrMailsContent"></ul>
        </div>
    </section>
</body>

<script>
    const TextBoxContent = document.getElementById('MailFormatsContent');
    const AnswBoxContent = document.getElementById('CorrMailsContent');
    let MailDomain = document.getElementById("InputDomain").value;
    let counter = true;

    function ArraytoTxt(array) {
        let txt = '';

        for (let i = 0; i < array.length; i++) {
            if (i == array.length - 1) {
                txt += array[i] + '\n';
            } else {
                txt += array[i];
            }
        }

        return txt
    }

    function PopUpWindow(DisplayText) {
        PopUpBox = document.getElementById('PopUpBox');
        PopUpBox.innerText = DisplayText;

        if (counter) {
            PopUpBox.style.animation = 'PopUp1 4s';
            counter = false;
        }
        else {
            PopUpBox.style.animation = 'PopUp2 4s';
            counter = true;
        }
    }

    function getAllMailFormats(FullName) {
        let AllMailFormats = {};
        let NameSliced = FullName.map((item, index) => { return index === 0 ? item : item.toLowerCase(); });

        AllMailFormats['Type1'] = NameSliced.join('');
        AllMailFormats['Type2'] = NameSliced.join('.');
        AllMailFormats['Type3'] = NameSliced.join('-');
        AllMailFormats['Type4'] = NameSliced.join('_');

        AllMailFormats['Type5'] = NameSliced[0];
        AllMailFormats['Type6'] = NameSliced[NameSliced.length - 1];

        AllMailFormats['Type7'] = NameSliced.slice(1).join('');
        AllMailFormats['Type8'] = NameSliced.map((i, index) => index === 0 ? i[0] : i).join('');
        AllMailFormats['Type9'] = NameSliced.map(i => i[0]).join('');
        AllMailFormats['Type10'] = NameSliced.map((i, index) => index === NameSliced.length - 1 ? i : i[0]).join('');
        AllMailFormats['Type11'] = NameSliced.map((i, index) => index === 0 ? i + '.' : i).join('');
        AllMailFormats['Type12'] = NameSliced.slice(1).map((i, index, arr) => index === arr.length - 1 ? i : i[0]).join('');

        AllMailFormats['Type13'] = NameSliced.map((i, index) => index === 0 ? i[0] : i).join('.');

        AllMailFormats['Type14'] = NameSliced.map((i, index) => index === 0 ? i[0] + '.' : i).join('');
        AllMailFormats['Type15'] = NameSliced.map((i, index) => index === 0 ? i[0] + '-' : i).join('');
        AllMailFormats['Type16'] = NameSliced.map((i, index) => index === 0 ? i[0] + '_' : i).join('');

        AllMailFormats['Type17'] = NameSliced.map((i, index) => index === 0 ? i + '-' : i).join('');
        AllMailFormats['Type18'] = NameSliced.map((i, index) => index === 0 ? i + '_' : i).join('');

        return AllMailFormats;
    }

    function createCorrMailListHTML() {
        const MailOptions = document.getElementsByClassName('MailOption');
        const AllNames = document.getElementById("allNames").value.split(', ');
        const MailKeys = Object.keys(MailOptions);
        let AllFormattedNames = [];
        let Type;

        for (let i = 0; i < MailOptions.length; i++) {
            MailOptions[MailKeys[i]].id = '';
            if (MailOptions[MailKeys[i]].textContent == this.innerHTML) {
                Type = i + 1;
            }
        }
        
        this.id = 'active';

        for (let FullName in AllNames) {
            AllFormattedNames.push(getAllMailFormats(AllNames[FullName].split(' '))[`Type${Type}`])
        }

        const AllCorrMails = Object.keys(AllFormattedNames).map(function (key) { return AllFormattedNames[key] + MailDomain; });
        AnswBoxContent.innerHTML = '';

        for (let CorrMail in AllCorrMails) {
            const li_CorrMail = document.createElement('li');
            li_CorrMail.innerText = AllCorrMails[CorrMail];
            li_CorrMail.classList.add('CorrMail');
            AnswBoxContent.appendChild(li_CorrMail);
        }



        navigator.clipboard.writeText(ArraytoTxt(AllCorrMails));
        PopUpWindow('All correctly ***formatted contacts*** are copied to your clipboard');
    }

    function createMailFormatsListHTML(AllMailFormats) {
        TextBoxContent.innerHTML = '';

        for (let MailOption in AllMailFormats) {
            const li_MailOption = document.createElement('li');
            li_MailOption.innerText = AllMailFormats[MailOption];
            li_MailOption.classList.add('MailOption');
            li_MailOption.addEventListener("click", createCorrMailListHTML);
            TextBoxContent.appendChild(li_MailOption);
        }
    }

    function getMailFormatOptions() {
        MailDomain = document.getElementById("InputDomain").value;
        const SplittedFullName = document.getElementById("InputFullName").value.split(' ');
        const MailFormatOptions = getAllMailFormats(SplittedFullName);
        const AllMailFormats = Object.keys(MailFormatOptions).map(function (key) { return MailFormatOptions[key] + MailDomain; });
        createMailFormatsListHTML(AllMailFormats);
        navigator.clipboard.writeText(ArraytoTxt(AllMailFormats));
        PopUpWindow("All possible ***mailing formats*** are copied to your clipboard");
    }
</script>
